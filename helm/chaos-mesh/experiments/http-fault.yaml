# HTTP Fault Injection
# Inject HTTP errors into test-api responses
apiVersion: chaos-mesh.org/v1alpha1
kind: HTTPChaos
metadata:
  name: test-api-http-500
  namespace: eventhub-poc
spec:
  mode: all
  selector:
    namespaces:
      - eventhub-poc
    labelSelectors:
      app.kubernetes.io/name: test-api
  target: Response
  port: 8089
  path: /api/accounts
  method: POST
  # Replace response with 500 error
  replace:
    code: 500
    body: '{"error": "Internal Server Error", "message": "Chaos injection - service unavailable"}'
    headers:
      Content-Type: application/json
  duration: "1m"
---
# HTTP 503 Service Unavailable
apiVersion: chaos-mesh.org/v1alpha1
kind: HTTPChaos
metadata:
  name: test-api-http-503
  namespace: eventhub-poc
spec:
  mode: all
  selector:
    namespaces:
      - eventhub-poc
    labelSelectors:
      app.kubernetes.io/name: test-api
  target: Response
  port: 8089
  path: /api/*
  method: POST
  replace:
    code: 503
    body: '{"error": "Service Unavailable", "message": "Chaos injection - try again later"}'
    headers:
      Content-Type: application/json
      Retry-After: "30"
  duration: "30s"
---
# HTTP Response Delay
apiVersion: chaos-mesh.org/v1alpha1
kind: HTTPChaos
metadata:
  name: test-api-http-delay
  namespace: eventhub-poc
spec:
  mode: all
  selector:
    namespaces:
      - eventhub-poc
    labelSelectors:
      app.kubernetes.io/name: test-api
  target: Response
  port: 8089
  path: /api/accounts
  method: POST
  delay: "5s"
  duration: "2m"
---
# HTTP 429 Rate Limiting
apiVersion: chaos-mesh.org/v1alpha1
kind: HTTPChaos
metadata:
  name: test-api-http-429
  namespace: eventhub-poc
spec:
  mode: all
  selector:
    namespaces:
      - eventhub-poc
    labelSelectors:
      app.kubernetes.io/name: test-api
  target: Response
  port: 8089
  path: /api/*
  replace:
    code: 429
    body: '{"error": "Too Many Requests", "message": "Rate limit exceeded"}'
    headers:
      Content-Type: application/json
      Retry-After: "60"
  duration: "1m"

